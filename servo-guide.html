<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servo Movement System: 初学者向けガイド</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.7;
            color: #2c3e50;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            background-attachment: fixed;
        }
        .container {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 10px 20px;
            background-color: #9b59b6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .back-link:hover {
            background-color: #8e44ad;
            transform: translateX(-5px);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }
        h1 span {
            display: block;
            font-size: 0.5em;
            color: #7f8c8d;
            font-weight: 400;
            margin-top: 10px;
        }
        h2 {
            color: #34495e;
            font-size: 1.6em;
            font-weight: 600;
            margin-top: 50px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        h3 {
            color: #34495e;
            font-size: 1.3em;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        p {
            margin-bottom: 20px;
            line-height: 1.8;
        }
        .analogy {
            background: linear-gradient(135deg, #f3e5f5 0%, #e8eaf6 100%);
            border-left: 4px solid #9b59b6;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
        }
        .analogy::before {
            content: "💡 イメージで理解";
            font-weight: 600;
            color: #8e44ad;
            font-size: 1.1em;
            display: block;
            margin-bottom: 12px;
        }
        .step-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        .step-box:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            font-weight: 600;
            font-size: 1.1em;
        }
        .math-explanation {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-left: 4px solid #9b59b6;
            padding: 20px;
            margin-top: 20px;
            border-radius: 6px;
        }
        .math-explanation h4 {
            margin-top: 0;
            color: #8e44ad;
            font-size: 1.05em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .formula {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            overflow-x: auto;
        }
        ol, ul {
            margin-left: 20px;
            line-height: 1.9;
        }
        li {
            margin-bottom: 10px;
        }
        strong {
            color: #2c3e50;
            font-weight: 600;
        }
        footer {
            margin-top: 60px;
            text-align: center;
            font-size: 0.9em;
            color: #95a5a6;
            padding-top: 30px;
            border-top: 1px solid #ecf0f1;
        }
        
        /* スマホ対応 */
        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }
            .container {
                padding: 30px 20px;
            }
            h1 {
                font-size: 1.8em;
            }
            h1 span {
                font-size: 0.55em;
            }
            h2 {
                font-size: 1.4em;
                margin-top: 35px;
            }
            h3 {
                font-size: 1.2em;
            }
            .step-box {
                padding: 20px;
            }
            .analogy {
                padding: 20px;
            }
            .formula {
                font-size: 0.9em;
                padding: 10px;
                overflow-x: auto;
            }
            .math-explanation {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            h2 {
                font-size: 1.2em;
            }
            h3 {
                font-size: 1.1em;
            }
            .formula {
                font-size: 0.8em;
            }
            .step-number {
                width: 28px;
                height: 28px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← トップページに戻る</a>

        <h1>Servo Movement System<span>技術発表資料（初学者向け）</span></h1>


    <h2>1. システムの背景と目的 (Background & Objective)</h2>
    <p>
        本システムの目的は、<strong>「路面情報を物理的な挙動に変換する遅延補償制御」</strong>です。
    </p>
    <p>
        RealSense Road Scannerで検出された路面の凹凸情報を、運転席に伝達するためには、
        単にモータを動かすだけでは不十分です。センサは車両前方にあり、実際にタイヤがその位置に到達するまでには
        時間差が存在します。本システムは、この時間差を補償し、適切なタイミングで適切な強度の物理フィードバックを生成します。
    </p>

    <h2>2. システム構成 (System Architecture)</h2>
    <p>
        Servo Movement Systemは、以下の3つの主要コンポーネントで構成されます。
    </p>

    <div class="step-box">
        <h3><span class="step-number">1</span>入力データ受信</h3>
        <p>
            RealSense Road Scannerから、障害物の検出情報（位置、高さ、時刻）を受け取ります。
        </p>
    </div>

    <div class="step-box">
        <h3><span class="step-number">2</span>遅延補償制御</h3>
        <p>
            車速と距離から到達時刻を計算し、コマンドをキュー（待ち行列）で管理します。
        </p>
    </div>

    <div class="step-box">
        <h3><span class="step-number">3</span>サーボ角度制御</h3>
        <p>
            適切なタイミングでサーボモータの角度を制御し、物理的な挙動を再現します。
        </p>
    </div>

    <div class="analogy">
        <p>
            <strong>💡 概念的な理解：</strong><br>
            これは「未来予約システム」に似ています。センサ（目）が障害物を見つけた瞬間に、
            「○秒後にタイヤがそこに到達するから、その時にモータを動かそう」と予約を入れます。
            時間が来たら予約を実行し、座席を揺らして衝撃を再現します。
        </p>
    </div>

    <h2>3. 遅延補償アルゴリズム (Delay Compensation)</h2>
    <p>
        センサ検知から実際の到達までの時間差を補償する処理について説明します。
    </p>

    <div class="step-box">
        <h3><span class="step-number">1</span>到達時刻の予測</h3>
        <p>
            障害物を検知した時点で、タイヤがその位置に到達する時刻を計算します。
        </p>
        
        <div class="math-explanation">
            <h4>🎓 数理モデル：到達時刻の算出</h4>
            <div class="formula">
                $$ t_{target} = t_{now} + T_{delay} $$
            </div>
            <div class="formula">
                $$ T_{delay} = \frac{L}{v} $$
            </div>
            <ul>
                <li>\( t_{target} \): サーボ作動時刻</li>
                <li>\( t_{now} \): 障害物検知時刻</li>
                <li>\( T_{delay} \): 到達までの遅延時間</li>
                <li>\( L \): カメラからタイヤまでの距離（約15cm = 0.15m）</li>
                <li>\( v \): 車両速度（m/s単位）</li>
            </ul>
            <p>
                例えば、車速が60km/h（16.7m/s）の場合、遅延時間は \( T_{delay} = 0.15 / 16.7 \approx 0.009 \) 秒（9ミリ秒）となります。
                ただし、本システムは1/8スケールモデルのため、実際の速度は8分の1となり、遅延時間は8倍の約72ミリ秒となります。
            </p>
        </div>
    </div>

    <div class="step-box">
        <h3><span class="step-number">2</span>コマンドキューイング</h3>
        <p>
            計算された到達時刻と共に、サーボ制御コマンドをキュー（待ち行列）に登録します。
        </p>
        
        <div class="math-explanation">
            <h4>🎓 データ構造：コマンドキュー</h4>
            <p>
                各コマンドは以下の情報を持ちます：
            </p>
            <ul>
                <li>実行時刻 \( t_{target} \)</li>
                <li>サーボ目標角度 \( \theta_{target} \)</li>
                <li>動作継続時間 \( \Delta t \)</li>
            </ul>
            <p>
                キューは時刻順にソートされ、メインループで現在時刻をチェックし続けます。
                現在時刻が \( t_{target} \) を超えたコマンドを順次実行していきます。
            </p>
        </div>
    </div>

    <h2>4. サーボ角度制御 (Servo Angle Control)</h2>
    <p>
        検出された障害物の情報から、サーボモータの目標角度を算出します。
    </p>

    <div class="step-box">
        <h3>角度算出モデル</h3>
        <div class="math-explanation">
            <h4>🎓 数理モデル：目標角度の生成</h4>
            <div class="formula">
                $$ \theta_{target} = \theta_{base} + k \cdot h_{obstacle} $$
            </div>
            <ul>
                <li>\( \theta_{target} \): 出力目標角度</li>
                <li>\( \theta_{base} \): 基準姿勢（通常は水平位置、例: 90°）</li>
                <li>\( k \): ゲイン係数（障害物高さを角度変化に変換）</li>
                <li>\( h_{obstacle} \): 検出された障害物の高さ</li>
            </ul>
            <p>
                例えば、20mmの突起を検出した場合、ゲイン \( k = 0.5 \) deg/mmとすると、
                \( \theta_{target} = 90° + 0.5 \times 20 = 100° \) となります。
            </p>
        </div>
    </div>

    <div class="step-box">
        <h3>動作パターン生成</h3>
        <p>
            単純に角度を変更するだけでなく、「衝撃」を再現するため、以下のような動作パターンを生成します。
        </p>
        <ol>
            <li><strong>初期位置：</strong> 基準角度 \( \theta_{base} \)</li>
            <li><strong>衝撃ピーク：</strong> 最大角度 \( \theta_{target} \) に急速移動（立ち上がり時間: 50ms）</li>
            <li><strong>減衰：</strong> 基準角度に戻る（減衰時間: 200ms）</li>
        </ol>
        <p>
            この一連の動作により、瞬間的な衝撃が物理的に再現されます。
        </p>
    </div>

    <h2>5. 適応制御 (Adaptive Control)</h2>
    <p>
        実際の走行では、タイヤのスリップや計測誤差により、予測到達時刻と実際の到達時刻にズレが生じます。
        本システムは、このズレを学習し、パラメータを自動調整します。
    </p>

    <div class="math-explanation">
        <h4>🎓 数理モデル：遅延パラメータの学習更新</h4>
        <p>
            ジャイロセンサや加速度センサで実際の衝撃を観測し、予測との差分を用いて補正します。
        </p>
        <div class="formula">
            $$ T_{delay}^{new} = T_{delay}^{old} + \beta \cdot (t_{measured} - t_{predicted}) $$
        </div>
        <ul>
            <li>\( T_{delay}^{new} \): 更新後の遅延パラメータ</li>
            <li>\( T_{delay}^{old} \): 更新前の遅延パラメータ</li>
            <li>\( \beta \): 学習率（0 < \( \beta \) < 1、例: 0.1）</li>
            <li>\( t_{measured} \): 実際に衝撃を観測した時刻</li>
            <li>\( t_{predicted} \): 予測した到達時刻</li>
        </ul>
        <p>
            この更新式により、システムは走行を重ねるごとに精度が向上していきます。
        </p>
    </div>

    <h2>6. タイミング制約 (Timing Constraints)</h2>
    <p>
        本システムにおける時間的な制約と性能について説明します。
    </p>

    <div class="step-box">
        <h3>処理速度と猶予時間</h3>
        <p>
            カメラとタイヤの距離が約15cm、1/8スケールで動作する本システムでは：
        </p>
        <ul>
            <li><strong>一般走行（60km/h相当）：</strong> 約72ミリ秒の猶予</li>
            <li><strong>高速走行（100km/h相当）：</strong> 約43ミリ秒の猶予</li>
        </ul>
        <p>
            システムの処理時間（約16〜33ミリ秒）と比較すると、十分な余裕があります。
            コマンドキューの管理は1ms以下で実行可能であり、リアルタイム制御として十分な性能を有しています。
        </p>
    </div>

    <h2>7. 想定される質問と回答 (Q&A)</h2>

    <div class="step-box">
        <h3>Q1. 車速が変化した場合、リアルタイムで対応できますか？</h3>
        <p>
            <strong>A. はい、毎フレーム速度を更新しています。</strong><br>
            遅延時間 \( T_{delay} = L / v \) は、障害物検知のたびに現在の速度 \( v \) を用いて計算されます。
            加速・減速中でも、その時点での速度に基づいて到達時刻が予測されるため、正確な制御が可能です。
        </p>
    </div>

    <div class="step-box">
        <h3>Q2. サーボモータの応答速度は十分ですか？</h3>
        <p>
            <strong>A. 一般的なホビー用サーボ（0.1秒/60°程度）で十分対応可能です。</strong><br>
            本システムで必要な角度変化は±10〜20°程度であり、50ms以内に到達可能です。
            これは猶予時間（43〜72ms）の範囲内に収まっています。
        </p>
    </div>

    <div class="step-box">
        <h3>Q3. 複数の障害物が連続している場合はどうなりますか？</h3>
        <p>
            <strong>A. コマンドキューで順次処理されます。</strong><br>
            各障害物に対して個別のコマンドが生成され、時刻順にキューに登録されます。
            実行タイミングが重複する場合は、最新のコマンドが優先されるか、
            または複数の衝撃を合成した動作が生成されます。
        </p>
    </div>

    <h2>8. まとめ</h2>
    <p>
        Servo Movement Systemは、以下の技術要素で構成されています。
    </p>
    <ol>
        <li><strong>遅延補償：</strong> 速度と距離から到達時刻を予測し、適切なタイミングで制御</li>
        <li><strong>角度制御：</strong> 障害物の高さをサーボ角度に変換し、物理的な挙動を再現</li>
        <li><strong>適応学習：</strong> 実測値との差分から遅延パラメータを自動調整</li>
    </ol>
    <p>
        これにより、RealSenseで検出された路面情報を、リアルタイムかつ高精度に物理フィードバックとして提示することが可能となり、
        遠隔操作やシミュレーション環境での臨場感を大幅に向上させます。
    </p>

    <footer>
        &copy; 2025 ServoDrive - Servo Movement System Project
    </footer>
    </div>
</body>
</html>
